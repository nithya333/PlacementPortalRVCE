{% extends "base.html" %}
{% load static %}
{% block body_here %}
<!-- Main Layout -->
<style>
  body {
      font-family: Arial, sans-serif;
      background-color: #ffe6cc;
  }

  .nav-link.active {
    background-color: #b35c00; /* Replace with your desired color */
    color: white; /* Adjust text color for better contrast */
  }

  .nav-link.active:hover {
    background-color: #994f00; /* Slightly darker shade for hover */
  }

  .student-icon {
    width: 60px;
    height: 60px;
    border-radius: 60%; /* Makes it circular */
    object-fit: cover; /* Ensures proper scaling of image */
  }
  .welcome-text {
    font-size: 1.2rem;
    font-weight: bold;
    color: #804200;
    text-decoration: '';
  }
  .student-name {
    color: #007bff; /* Highlighted color for student name */
  }


    .nav-pills .nav-link.active {
        background-color: #b35c00 !important; /* Replace with your desired color */
        color: white !important; /* Optional: Change text color to ensure readability */
    }
    
    /* Optional: Hover effect for other tabs */
    .nav-pills .nav-link:hover {
        background-color: #804200; /* Replace with your desired hover color */
        color: #000; /* Replace with your desired hover text color */
    }
    .stage-card {
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      width: 950px;
      overflow: hidden;
  }
  .stage-header {
      background-color: #ffc180;
      color: #4d2800;
      padding: 10px 15px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
  .stage-content {
      display: none;
      padding: 15px;
      overflow-x: auto;
  }
  .stage-content.active {
      display: block;
  }
  table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff5e6;
      min-width: 1000px;
  }
  th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
  }
  th {
      background-color: #ffdb99;
      position: sticky;
      top: 0;
  }
  .table-container {
      overflow-x: auto;
      max-width: 100%;
  }
  select {
      margin-bottom: 20px;
      padding: 5px;
  }

  #accordion button {
    text-decoration: none !important;
    font-family: Arial, sans-serif;
    color: #804200;
  }

  #accordion table {
    color: #666666;
  }
</style>

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Include Popper.js (required for Bootstrap JS) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>

<!-- Include Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>


<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

<div class="d-flex">
    <div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 20%;">
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="#" class="welcome-text" aria-current="page">
            <img 
            src="{% static 'images/head_icon.png' %}" 
            alt="Student Icon" 
              class="student-icon"
              >
              {{ request.session.u_name }}
            </a>
          </li>
          <hr>
          <li class="nav-item">
            <a href="/head/home" class="nav-link link-dark" >
                <i class="bi bi-house-door me-2"></i>
                Home
            </a>
          </li>
          <li>
            <a href="/head/allot_slots" class="nav-link link-dark" >
                <i class="bi bi-calendar me-2"></i>
              Schedule Slots
            </a>
          </li>
          <li>
            <a href="/head/track_placements" class="nav-link active" style = "background-color: #b35c00; ">
                <i class="bi bi-grid-fill me-2"></i>
             Track Placements
            </a>
          </li>
          <li>
            <a href="/head/review_feedback" class="nav-link link-dark">
                <i class="bi bi-search me-2"></i>
              Review Feedback
            </a>
          </li>
        </ul>
        <hr>
      </div>
    <!-- Main Content -->
    <div>
      <br>
      <div style="display: flex; gap: 10px; align-items: center;">
        <label for="degree">Select Degree:</label>
        <select id="degree" style="width: 250px; margin-right: 50px;">
          <option value="ug">Undergraduate</option>
          <option value="pg">Postgraduate</option>
        </select>
        
        <label for="department">Select Department:</label>
        <select id="department" style="width: 250px;">
          {% for dept in dept_list %}
          <option value="{{dept}}">{{dept}}</option>
          {% endfor %}
        </select>
      </div>
      <br>
      <div class="container my-5" >
        {% comment %} <div class="card shadow border-0" > {% endcomment %}

          <div id="stages-container"></div>
        {% comment %} </div> {% endcomment %}
      </div>

  </div>
  
</div>
<script>
  {% comment %} fetch('/head/head_track_placements/')
    .then(response => response.json())
    .then(data => {
        console.log(data.jobs);
        // Populate the UI using data.jobs
    })
    .catch(error => console.error('Error fetching jobs:', error));  {% endcomment %}

    // const jobData = [{'_id': '0x9ce1fd9f26ee920ca5f1bdc859404ea3', 'job_title': 'Blockchain Dev', 'job_type': 'full-time', 'job_duration': '3 months', 'job_desc': 'Data Scientist', 'job_domain': 'Management', 'job_salary': 11.96, 'cgpaMinCriteria': 7.5, 'cgpaMaxCriteria': 10, 'degreeCriteria': 'pg', 'job_locations': ['Pune', 'Chennai'], 'deptsCriteria': ['MCE', 'MPE', 'MCN'], 'yearOfPassingCriteria': [2027, 2025], 'skillsPreferences': ['data analysis', 'Web dev'], 'job_enrolledDate': '2024-12-19', 'job_pptDate': '2024-12-24', 'job_oaDate': '2024-12-28', 'job_interviewDate': '2025-01-01', 'job_status': 2, 'job_stage': 6, 'job_companyId': 'C001', 'job_companyName': 'Google', 'job_numStudents': 49, 'job_lastUpdated': '2025-01-01', 'job_id': '0x9ce1fd9f26ee920ca5f1bdc859404ea3', 'applicants': []}, {'_id': '0xcd3f67cfc249ca66f571ede6f7c4e24a', 'job_title': 'Mobile App Developer', 'job_type': 'internship', 'job_duration': '3 months', 'job_desc': 'Web Developer', 'job_domain': 'Networking', 'job_salary': 13.74, 'cgpaMinCriteria': 7.5, 'cgpaMaxCriteria': 10, 'degreeCriteria': 'pg', 'job_locations': ['Delhi', 'Pune'], 'deptsCriteria': ['MCS', 'MHT', 'MPE', 'MCN'], 'yearOfPassingCriteria': [2026], 'skillsPreferences': ['data analysis', 'app dev'], 'job_enrolledDate': '2024-12-25', 'job_pptDate': '2025-01-01', 'job_oaDate': '2025-02-08', 'job_interviewDate': '2025-02-18', 'job_status': 2, 'job_stage': 6, 'job_companyId': 'C001', 'job_companyName': 'Google', 'job_numStudents': 2, 'job_lastUpdated': '2024-12-28', 'job_id': '0xcd3f67cfc249ca66f571ede6f7c4e24a', 'applicants': [{ 'appl_id': '678b2f96b988baa4f510bde2', 'appl_date': '2025-01-18 10:05:34', 'appl_student_id': '1RV24MCN016', 'appl_job_id': '0xcd3f67cfc249ca66f571ede6f7c4e24a', 'appl_status': 1, 'appl_stage': 6, 'appl_lastUpdated': '2025-01-18 10:05:34', 'appl_interview_result': 'Select', 'st_id': '1RV24MCN016', 'st_name': 'Kavita Desai', 'st_email': 'kavita.desai82@rvce.edu.in', 'st_section': 'MCN  ', 'st_year_of_passing': 2026, 'e_cgpa': 9.5, 'e_10thmarks': 95.0, 'e_10thstream': 'cbse', 'e_12thmarks': 78.0, 'e_12thstream': 'isc', 'e_backlogs': 0}]}, {'_id': '0xb1400f91d28811f193440dc072ac7cf9', 'job_title': 'Data Analyst', 'job_type': 'full-time', 'job_duration': '12 months', 'job_desc': 'AI Engineer', 'job_domain': 'Networking', 'job_salary': 19.59, 'cgpaMinCriteria': 8.5, 'cgpaMaxCriteria': 9.5, 'degreeCriteria': 'pg', 'job_locations': ['Delhi', 'Mumbai'], 'deptsCriteria': ['MDC', 'MCN'], 'yearOfPassingCriteria': [2026], 'skillsPreferences': ['data analysis', 'app dev'], 'job_enrolledDate': '2024-12-24', 'job_pptDate': '', 'job_oaDate': '', 'job_interviewDate': '', 'job_status': 0, 'job_stage': 0, 'job_companyId': 'C002', 'job_companyName': 'SAP', 'job_numStudents': 0, 'job_lastUpdated': '2024-12-24', 'job_id': '0xb1400f91d28811f193440dc072ac7cf9', 'applicants': []}, {'_id': '0xffe71596a17ed117d03e980be5f2f19', 'job_title': 'QA Engineer', 'job_type': 'internship', 'job_duration': 'Full time', 'job_desc': 'Software Developer', 'job_domain': 'Aerospace Engineering', 'job_salary': 11.66, 'cgpaMinCriteria': 7, 'cgpaMaxCriteria': 10, 'degreeCriteria': 'pg', 'job_locations': ['Hyderabad', 'Bengaluru'], 'deptsCriteria': ['MCS', 'MCN'], 'yearOfPassingCriteria': [2027, 2026], 'skillsPreferences': ['machine learning', 'app dev'], 'job_enrolledDate': '2024-12-17', 'job_pptDate': '2025-2-20', 'job_oaDate': '2025-2-26', 'job_interviewDate': '2025-03-03', 'job_status': 1, 'job_stage': 2, 'job_companyId': 'C001', 'job_companyName': 'Google', 'job_numStudents': 42, 'job_lastUpdated': '2024-12-19', 'job_id': '0xffe71596a17ed117d03e980be5f2f19', 'applicants': [{ 'appl_id': '671b2f96b988faa4f510bde4', 'appl_date': '2025-01-20 10:05:34', 'appl_student_id': '1RV24MCN016', 'appl_job_id': '0xffe71596a17ed117d03e980be5f2f19', 'appl_status': 0, 'appl_stage': 2, 'appl_lastUpdated': '2025-01-18 10:05:34', 'st_id': '1RV24MCN016', 'st_name': 'Kavita Desai', 'st_email': 'kavita.desai82@rvce.edu.in', 'st_section': 'MCN  ', 'st_year_of_passing': 2026, 'e_cgpa': 9.5, 'e_10thmarks': 95.0, 'e_10thstream': 'cbse', 'e_12thmarks': 78.0, 'e_12thstream': 'isc', 'e_backlogs': 0}]}, {'_id': '0xbb43e25c5fe340e232bbccbe2560c018', 'job_title': 'Cybersecurity Analyst', 'job_type': 'full-time', 'job_duration': '2 months', 'job_desc': 'Data Scientist', 'job_domain': 'Aerospace Engineering', 'job_salary': 11.81, 'cgpaMinCriteria': 7, 'cgpaMaxCriteria': 9.5, 'degreeCriteria': 'pg', 'job_locations': ['Pune', 'Delhi'], 'deptsCriteria': ['MHT', 'MCN'], 'yearOfPassingCriteria': [2028, 2027], 'skillsPreferences': ['Web dev', 'embedded systems'], 'job_enrolledDate': '2025-01-01', 'job_pptDate': '2025-01-06', 'job_oaDate': '2025-01-12', 'job_interviewDate': '2025-01-19', 'job_status': 1, 'job_stage': 5, 'job_companyId': 'C003', 'job_companyName': 'Dell', 'job_numStudents': 46, 'job_lastUpdated': '2025-01-04', 'job_id': '0xbb43e25c5fe340e232bbccbe2560c018', 'applicants': []}, {'_id': '0xb92b11213da785339d0ff1dc5ff82c37', 'job_title': 'Data Analyst', 'job_type': 'internship', 'job_duration': '3 months', 'job_desc': 'App Developer', 'job_domain': 'Automation', 'job_salary': 11.6, 'cgpaMinCriteria': 8, 'cgpaMaxCriteria': 10, 'degreeCriteria': 'pg', 'job_locations': ['Hyderabad', 'Delhi'], 'deptsCriteria': ['MPE', 'MCN'], 'yearOfPassingCriteria': [2028, 2027], 'skillsPreferences': ['data analysis', 'Web dev'], 'job_enrolledDate': '2024-12-19', 'job_pptDate': '2024-12-23', 'job_oaDate': '2024-12-26', 'job_interviewDate': '2024-12-29', 'job_status': 2, 'job_stage': 7, 'job_companyId': 'C004', 'job_companyName': 'Aveva', 'job_numStudents': 47, 'job_lastUpdated': '2024-12-29', 'job_id': '0xb92b11213da785339d0ff1dc5ff82c37', 'applicants': []}, {'_id': '0x6764055b3accc951c7b4ed2e03c354f8', 'job_title': 'AI Researcher', 'job_type': 'full-time', 'job_duration': 'Full time', 'job_desc': 'AI Engineer', 'job_domain': 'Biomedical Engineering', 'job_salary': 17.13, 'cgpaMinCriteria': 8.5, 'cgpaMaxCriteria': 10, 'degreeCriteria': 'pg', 'job_locations': ['Delhi', 'Bengaluru'], 'deptsCriteria': ['MPE', 'MCN'], 'yearOfPassingCriteria': [2026], 'skillsPreferences': ['AI', 'networking'], 'job_enrolledDate': '2024-12-30', 'job_pptDate': '2025-01-06', 'job_oaDate': '2025-01-11', 'job_interviewDate': '2025-01-19', 'job_status': 1, 'job_stage': 4, 'job_companyId': 'C004', 'job_companyName': 'Aveva', 'job_numStudents': 41, 'job_lastUpdated': '2025-01-02', 'job_id': '0x6764055b3accc951c7b4ed2e03c354f8', 'applicants': []}, {'_id': '0x5cc995aab206a79c14181ff65cbf555b', 'job_title': 'Embedded Systems', 'job_type': 'internship', 'job_duration': '3 months', 'job_desc': 'AI Engineer', 'job_domain': 'Software Development', 'job_salary': 10.87, 'cgpaMinCriteria': 8, 'cgpaMaxCriteria': 9.5, 'degreeCriteria': 'pg', 'job_locations': ['Delhi', 'Pune'], 'deptsCriteria': ['MPE', 'MCN'], 'yearOfPassingCriteria': [2028], 'skillsPreferences': ['networking', 'embedded systems'], 'job_enrolledDate': '2024-12-19', 'job_pptDate': '2024-12-23', 'job_oaDate': '2024-12-27', 'job_interviewDate': '2024-12-31', 'job_status': 1, 'job_stage': 6, 'job_companyId': 'C005', 'job_companyName': 'Cisco', 'job_numStudents': 48, 'job_lastUpdated': '2024-12-31', 'job_id': '0x5cc995aab206a79c14181ff65cbf555b', 'applicants': []}, {'_id': '0xd8363c4caecae219accf1942a4001522', 'job_title': 'Systems Engineer', 'job_type': 'full-time', 'job_duration': '2 months', 'job_desc': 'AI Engineer', 'job_domain': 'Mechanical Engineering', 'job_salary': 16.57, 'cgpaMinCriteria': 7.5, 'cgpaMaxCriteria': 9.5, 'degreeCriteria': 'pg', 'job_locations': ['Hyderabad', 'Bengaluru'], 'deptsCriteria': ['MHT', 'MPE', 'MDC', 'MCN'], 'yearOfPassingCriteria': [2028], 'skillsPreferences': ['app dev', 'machine learning'], 'job_enrolledDate': '2025-01-02', 'job_pptDate': '', 'job_oaDate': '', 'job_interviewDate': '', 'job_status': 1, 'job_stage': 0, 'job_companyId': 'C005', 'job_companyName': 'Cisco', 'job_numStudents': 0, 'job_lastUpdated': '2025-01-02', 'job_id': '0xd8363c4caecae219accf1942a4001522', 'applicants': []}, {'_id': '678e2ad339b1d9881bb44e13', 'job_title': 'SWE', 'job_type': 'internship', 'job_duration': '3 months', 'job_desc': 'tt', 'job_domain': 'data_science', 'job_salary': 14.0, 'cgpaMinCriteria': 7.5, 'cgpaMaxCriteria': 10.0, 'degreeCriteria': 'pg', 'job_locations': ['Bengaluru', 'Mumbai'], 'deptsCriteria': ['MVE', 'MCN'], 'yearOfPassingCriteria': [2026], 'skillsPreferences': ['Web dev', 'app dev'], 'job_enrolledDate': '2025-01-20 16:22:03', 'job_pptDate': '2025-01-23', 'job_oaDate': '2025-01-29', 'job_interviewDate': '2025-02-01', 'job_status': 1, 'job_stage': 5, 'job_companyId': 'C005', 'job_companyName': 'Cisco', 'job_numStudents': 1, 'job_lastUpdated': '2025-01-20 16:23:11', 'job_id': '678e2ad339b1d9881bb44e13', 'applicants': []}];
    const jobData = {{ jobs_list|safe }};
    const stages = [
        [0, "Company posted a job offer, Waiting for college approval"],
        [1, "College has scheduled slots, Student registrations open"],
        [2, "Applications closed, Waiting for college shortlists"],
        [3, "Shortlisted at college level"],
        [4, "PPT done"],
        [5, "OA - Round 1 done"],
        [6, "Interview - Round 2 done"]
    ];

    const degreeDropdown = document.getElementById('degree');
    const departmentDropdown = document.getElementById('department');
    const stagesContainer = document.getElementById('stages-container');

    function filterAndDisplayJobs() {
        // Get selected degree and department
        const selectedDegree = degreeDropdown.value;
        const selectedDepartment = departmentDropdown.value;

        // Filter jobs based on selected criteria
        const filteredJobs = jobData.filter(job =>
            job.degreeCriteria === selectedDegree &&
            job.deptsCriteria.includes(selectedDepartment)
        );

        // Generate table for each stage
        stages.forEach(stage => {
            const stageNumber = stage[0];
            const stageDescription = stage[1];

            // Get jobs in the current stage
            const jobsInStage = filteredJobs.filter(job => job.job_stage === stageNumber);

            if (jobsInStage.length > 0) {
              const stageCard = document.createElement('div');
              stageCard.className = 'stage-card';

              const stageHeader = document.createElement('div');
              stageHeader.className = 'stage-header';
              stageHeader.innerHTML = `
                  <h4>Stage ${stageNumber}: ${stageDescription}</h4>
                  <span class="toggle-icon">▼</span>
              `;
              stageHeader.onclick = () => toggleStageContent(stageCard);

              const stageContent = document.createElement('div');
              stageContent.className = 'stage-content';

              const tableContainer = document.createElement('div');
              tableContainer.className = 'table-container';

              const stageTable = document.createElement('table');
              stageTable.innerHTML = `
                  <thead>
                      <tr>
                          <th rowspan="2">Job Title</th>
                          <th rowspan="2">Recruiter</th>
                          <th rowspan="2">Job Type</th>
                          <th rowspan="2">Job Salary</th>
                          <th colspan="6">Applicants Info</th>
                      </tr>
                      <tr>
                          <th>Names</th>
                          <th>Emails</th>
                          <th>IDs</th>
                          <th>CGPAs</th>
                          <th>10th %</th>
                          <th>12th %</th>
                      </tr>
                  </thead>
                  <tbody>
                      ${jobsInStage.map(job => `
                          <tr>
                              <td rowspan="${Math.max(job.applicants.length, 1)}">${job.job_title}</td>
                              <td rowspan="${Math.max(job.applicants.length, 1)}">${job.job_companyName}</td>
                              <td rowspan="${Math.max(job.applicants.length, 1)}">${job.job_type}</td>
                              <td rowspan="${Math.max(job.applicants.length, 1)}">${job.job_salary}</td>
                              ${job.applicants.length > 0 ? job.applicants.map((applicant, index) => `
                                  ${index === 0 ? '' : '<tr>'}
                                  <td>${applicant.st_name}</td>
                                  <td>${applicant.st_email}</td>
                                  <td>${applicant.st_id}</td>
                                  <td>${applicant.e_cgpa}</td>
                                  <td>${applicant.e_10thmarks}</td>
                                  <td>${applicant.e_12thmarks}</td>
                                  ${index === 0 ? '' : '</tr>'}
                              `).join('') : `
                                  <td>-</td>
                                  <td>-</td>
                                  <td>-</td>
                                  <td>-</td>
                                  <td>-</td>
                                  <td>-</td>
                              `}
                          </tr>
                      `).join('')}
                  </tbody>
              `;

              tableContainer.appendChild(stageTable);
              stageContent.appendChild(tableContainer);
              stageCard.appendChild(stageHeader);
              stageCard.appendChild(stageContent);
              stagesContainer.appendChild(stageCard);
          }
        });
    }

    function toggleStageContent(stageCard) {
      const content = stageCard.querySelector('.stage-content');
      const icon = stageCard.querySelector('.toggle-icon');
      content.classList.toggle('active');
      icon.textContent = content.classList.contains('active') ? '▲' : '▼';
  }

    // Add event listeners
    degreeDropdown.addEventListener('change', filterAndDisplayJobs);
    departmentDropdown.addEventListener('change', filterAndDisplayJobs);

    // Initial display
    filterAndDisplayJobs();
</script>
{% endblock %}